### TiDB in Action: 最佳实践

#### 1.适用场景介绍
1. 分库分表的缺点：
  * 业务需要提供切分维度
  * 不支持在线 DDL 操作，不能在线进行扩缩容
  * 不能跨维度 Join / 聚合 / 子查询，不支持分布式事务。
  * 业务程序从单机数据库迁移到分库分表方案时，通常要完成大量的开发适配改造。
  * 不能实现一致性的备份还原，难以实现异地容灾等。

#### 2.硬件选型规划
1. TiDB server 组件
  * 整个系统的瓶颈大概率先出现在 tidb-server
  * tidb-server 的 cpu 高一点，数量多一点是一个更好的选择。
1. PD 组件
  * 推荐使用 SSD 磁盘。至少三个节点。单独部署。
1. TiKV 组件
  * 建议你为 TiKV 多分配或预留些资源
  * 实例个数推荐是副本数的倍数
1. 监控组件：8GB 内存、2核 CPU 在大多数情况下已经够用

#### 3.常见性能压测
1. TPC-C 测试模型给基准测试提供了一种统一的测试标准。
1. BenchmarkSQL 内嵌了 TPC-C 测试脚本，可以测试 PostgreSQL、MySQL、Oracle、TIDB 
1. [NewSql的tpcc测试](https://www.jianshu.com/p/769611dd86b7)
  * percona的sysbench-tpcc测试CRDB和TiDB
  * percona的tpcc-mysql可以测试TiDB
  * TiDB的自家方案：改造BenchmarkSQL
  * CRDB的自家方案：自己开发的，也可以用BenchmarkSQL

```
// 新建配置sysbench/tidb_conf
mysql-host=192.168.xxx.xxx
mysql-port=4000
mysql-user=sysbench
mysql-password=******
mysql-db=test
time=30            //总测试时间
threads=4          //线程数
report-interval=10 //10秒出一次报告
db-driver=mysql    //mysql或pgsql

// 测试insert，若--tables=2，表示插入2张表sbtest1、sbtest2，分别插入10000条数据
sysbench --config-file=sysbench/tidb_conf oltp_point_select --tables=1 --table-size=10000 prepare
// 测试select
sysbench --config-file=sysbench/tidb_conf oltp_point_select --tables=1 --table-size=10000 run
// 测试update index
sysbench --config-file=sysbench/tidb_conf oltp_update_index --tables=1 --table-size=10000 run
```

#### 4.跨数据中心方案

