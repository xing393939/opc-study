### Redis 深度历险

#### 第1篇 基础和应用篇
* 5种基础的数据类型：string、list、hash、set、zset
* 分布式锁：
  * 加锁的原子操作（设置key、设置过期时间）
  * 释放锁的原子操作（匹配value、判断是否删除）
  * 缺点：T1执行时间超过了锁的过期时间，T2加锁成功并执行
* 延迟队列和位图
* HyperLogLog的原理：
  * N个随机整数、低位连续0的最大长度K：N = 2 ^ K
  * 假设只有一个桶来存储，可能因为个别离群值导致误差
  * 假设预置1024个桶，把N个整数分散到这1024个桶，最后对1024个桶求和，可以减少误差
  * redis的HyperLogLog有16384个桶，每个桶用6b存储K值，占用内存：16384 * 6 / 8 = 12K
* BloomFilter：
  * 一个元素的指纹空间如果占8b，错误率约2%，最佳hash数量是8 * 0.7
  * 一个元素的指纹空间如果占15b，错误率约0.1%，最佳hash数量是15 * 0.7
  * 使用时先预置好内存（最大数据容量已确定），若后续数据量超过最大容量，则需要重建BloomFilter
* Redis-Cell：限流模块
* GeoHash：地理位置
* scan：分页扫描时，采用“高位进位加法”，保证了不受扩容缩容的影响而导致漏了key（但可能会重复）

#### 第2篇 原理篇
* 线程IO模型：多路复用I/O模型Linux使用epoll、Unix使用kqueue
* 客户端管道：echo -e "PING\r\nPING\r\nPING\r\n"|nc localhost 6379
* redis事务：redis禁止在multi和exec之间执行watch，必须在multi之前执行watch
* 订阅：subscribe阻塞循环读，读其他线程publish的消息
* 小对象压缩：ziplist和intset